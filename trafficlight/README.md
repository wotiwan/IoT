# Traffic Light (Светофор)

## Видео демонстрация работы
https://vk.com/video317252242_456239500?list=ln-F0TKBtdOrbeZimQMH8

## Описание схемы
![circuit](https://github.com/user-attachments/assets/5b300c6e-c717-4142-9827-ceeaaf8ef8e0)
1. **Принципиальная схема**
   - Каждый светодиод подключён к своему "+", на плате это пины 11, 10 и 9
   - Все светодиоды подключены к "-" через один резистор, котороый подключён в пин GND
   - Резистор номиналом 5 кОм
## Реализация в коде
1. **В функции loop реализованы две функции:**
```
update_state();
process_state();
```
### `update_state()`
Проверяет наличие команд от пользователя и переключает состояние программы при определённых условиях.
Также следит за временем ручного режима
- В коде есть состояние программы `state`: авто или ручной режим.
- В ручном можно выбрать сигнал светофора `M_state` 
- При получении команды `'a'` — включается автоматический режим.
- При получении команды `'m'` — включается ручной режим.
- В ручном режиме можно переключаться между красным `'r'` и зелёным `'g'` сигналами.
- В ручном режиме если текущий свет светофора не соответствует запрошенному, перевод происходит через жёлтый сигнал `change_through_yellow()`.
- Если ручной режим активен более 60 секунд, программа возвращается в автоматический режим.

### `process_state()`
Обрабатывает текущее состояние программы:
- Если включен автоматический режим `STATE_AUTO`, выполняется последовательное переключение сигналов через функцию `auto_change()`.
- После перехода в ручной режим до смены на нужный сигнал светофороа (до команды пользователя) горит жёлтый сигнал
- в зависимости от команды пользователя включается соответствующий светодиод (красный или зелёный)

### `auto_change()`
Отвечает за автоматическую смену сигналов светофора в следующей последовательности:
1. Включение зелёного сигнала на 10 секунд.
2. Мигающий зелёный сигнал (4 такта по 500 мс).
3. Включение жёлтого сигнала на 1 секунду.
4. Включение красного сигнала на 7 секунд.
5. Возвращение к жёлтому сигналу на 1 секунду.

Каждое изменение сигнала сопровождается отслеживанием времени через функцию `millis()`.
Каждая смена сигнала находится внутри цикла `while(true)` до тех пор, пока не пройдёт время его интервала после прошлой смены сигнала.
После смены сигнала обновляется переменная `start_time`, для следующего цикла `while(true)` это будет точкой отсчёта своего интервала.

### `leds_off()`
Выключает все светодиоды. Используется для сброса состояния перед включением нужного сигнала.
